# BUG-2024-12-19-05: LifeModel Macro Missing with-json Feature Flag

**Date:** 2024-12-19  
**Status:** ✅ **FIXED**  
**Priority:** High  
**Severity:** Bug - Compilation errors for JSON fields

## Summary

The `Value::Json` variant was not available because the `with-json` feature flag was not enabled for the `sea-query` dependency. This caused `E0599: no variant or associated item named `Json` found for enum `Value`` errors when trying to use JSON fields.

## Discovery

**Date:** 2024-12-19  
**Source:** Test failure audit  
**Severity:** `high`  
**Status:** `fixed`

## Location

- **Files:** `Cargo.toml` files (both main and lifeguard-derive)

## Description

The `sea-query` crate's `Value::Json` variant is behind a feature flag (`with-json`) that must be explicitly enabled. The feature flag was not enabled in the dependency declaration.

**Before (Buggy Code):**
```toml
[dependencies]
sea-query = { version = "1.0.0-rc.29" }
```

**Problem:**
- `Value::Json` variant requires `with-json` feature flag
- Feature flag was not enabled in `Cargo.toml`
- JSON field handling code failed to compile
- Batch operations with JSON fields failed

## Root Cause

The `sea-query` crate's `Value::Json` variant is behind a feature flag (`with-json`) that must be explicitly enabled. The feature flag was not enabled in the dependency declaration.

## Fix

**After (Fixed Code):**
```toml
[dependencies]
sea-query = { version = "1.0.0-rc.29", features = ["with-json"] }
```

**Changes:**
1. ✅ Added `features = ["with-json"]` to `sea-query` dependency in main `Cargo.toml`
2. ✅ Added `features = ["with-json"]` to `sea-query` dependency in `lifeguard-derive/Cargo.toml`
3. ✅ Added `Value::Json(Some/None)` handling to all batch operations with `#[cfg(feature = "with-json")]` guards

## Testing

**Impact:**
- **Before Fix:** Multiple E0599 errors for JSON fields
- **After Fix:** All E0599 Json errors resolved (0 remaining)

## Impact

- **Before Fix:**
  - JSON fields could not be used in models
  - Batch operations with JSON fields failed to compile
  - `Value::Json` variant was unavailable

- **After Fix:**
  - JSON fields work correctly in models
  - Batch operations handle JSON fields properly
  - `Value::Json` variant is available when feature is enabled

## Related Files

- `Cargo.toml` - Added `with-json` feature flag
- `lifeguard-derive/Cargo.toml` - Added `with-json` feature flag
- `lifeguard-derive/src/macros/life_model.rs` - Added JSON handling
- `lifeguard-derive/tests/TEST_FAILURE_AUDIT.md` - Documents this bug and fix

## Verification

- [x] Bug identified and root cause analyzed
- [x] Fix implemented
- [x] All E0599 Json errors resolved
- [x] JSON fields work correctly
